---
title: "Mass Shootings in the USA"
author: "Hannah Reitz & Sophie Hensgen"
date: "5/14/2020"
output: html_document
---

```{r}
library(openxlsx)
library(xml2)
library(rvest)
library(jsonlite)
library(robotstxt)
library(RSocrata)
library(dplyr)
library(rlist)
library(pipeR)

```
## Theory and Hypotheses

More dead people --> more media attention --> higher attention in Google trends

newworthiness in den Medien

1. The more people got injured, the longer the shooting stayed in the trends.

2. The more deaths, the longer the shooting stayed in the trends.

evtl. newswothiness in Kombination mit inequality

3. The more caucasians got shot or died during the shooting, the longer it stayed
in the trends.

4. Shootings in richer areas, stayed longer in the trends.



5. In states with looser gun control, shootings stayed longer in the trends


## Data from Wikipedia

Erlärung welche Daten, wie gescrapt, wie sehen die Daten aus Deskription


```{r}
url <- "https://en.wikipedia.org/wiki/List_of_mass_shootings_in_the_United_States"
t <- read_html(url)
table <- t %>% html_nodes("#mw-content-text > div > table") %>% html_table(trim=T)

table

```

hier Tabellen zusammensetzten

erstes klappt, danach gibt es ein problem mit incompatiblen types. 
Ich glaube wir müssen die buchstaben aus injured rausholen damit wir es in einen integer umändern können

To Do:

- gsub loop --> alle alle nicht zahlen rausziehen
- alle mutaten damit alle integer sein 
- wenn das gemacht alle joinen zu einer großen tabelle
- in excel Extra Variablen hinzufügen
- Datum in Zahlen ändern
- zwei neue variablen, eine zwei Tage vor dem Event und 14 Tage danach
- Description den Namen herausnehmen

```{r}
newtab <- table[[1]]

newtab <- newtab %>% full_join(table[[2]], by = c("Date", "Location", "Dead", "Injured", "Total", "Description"))
newtab
newtab <- newtab %>% full_join(tab, by = c("Date", "Location", "Dead", "Injured", "Total", "Description"))


tab18 <- table[[3]]
tab18$Injured <- gsub("[n 1]", "", tab18$Injured, fixed = TRUE)
tab18$Injured <- gsub("[n 2]", "", tab18$Injured, fixed = TRUE)
tab18$Injured <- gsub("+", "", tab18$Injured, fixed = TRUE)
tab18

zahl <- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)

# nochmal drüber schauen!
  for (k in zahl) {
  k <- table[[k]]
  k$Injured <- gsub("[n 1]", "", k$Injured, fixed = TRUE)
}

tab18<- gsub("n 1", "", tab18)
tab <- table[[3]] %>%  
    mutate(Injured = as.integer(Injured))
tab

```

Wenn wir das geschafft haben sollten wir diesen Loop nutzen können
Zurzeit funktioniert er noch nicht
```{r}
new <- table[[1]]
for (i in 2:10){
  newtab <- newtab %>% full_join(table[[i]])
}

newtab
```








